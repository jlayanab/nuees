import 'dart:math';

class Program {
  List<List<int>> mabsBoxes = [
    [
      29,
      59,
      98,
      83,
      49,
      57,
      23,
      62,
      63,
      24,
      44,
      55,
      39,
      15,
      52,
      13,
      30,
      79,
      27,
      53,
      38,
      96,
      41,
      6,
      9,
      67,
      56,
      18,
      40,
      0,
      16,
      68,
      47,
      35,
      60,
      33,
      88,
      58,
      20,
      12,
      28,
      22,
      50,
      71,
      10,
      93,
      97,
      32,
      95,
      4,
      42,
      89,
      14,
      19,
      69,
      11,
      26,
      5,
      37,
      1,
      34,
      92,
      7,
      8,
      66,
      70,
      64,
      25,
      31,
      54,
      65,
      43,
      77,
      80,
      81,
      84,
      78,
      72,
      76,
      17,
      73,
      74,
      90,
      3,
      75,
      94,
      87,
      86,
      36,
      51,
      82,
      99,
      61,
      45,
      85,
      48,
      21,
      46,
      2,
      91
    ],
    [
      2,
      54,
      0,
      64,
      32,
      45,
      97,
      85,
      58,
      89,
      59,
      82,
      56,
      25,
      81,
      46,
      40,
      19,
      31,
      17,
      80,
      78,
      34,
      55,
      96,
      13,
      98,
      49,
      88,
      53,
      62,
      18,
      4,
      91,
      22,
      63,
      57,
      76,
      50,
      92,
      16,
      93,
      70,
      94,
      66,
      5,
      15,
      75,
      77,
      27,
      38,
      68,
      87,
      29,
      1,
      23,
      12,
      36,
      8,
      10,
      72,
      71,
      30,
      35,
      3,
      74,
      44,
      86,
      51,
      84,
      42,
      61,
      60,
      95,
      65,
      47,
      37,
      48,
      21,
      83,
      20,
      14,
      11,
      79,
      69,
      7,
      67,
      52,
      28,
      9,
      99,
      33,
      39,
      41,
      43,
      73,
      24,
      6,
      26,
      90
    ],
    [
      28,
      67,
      38,
      10,
      53,
      92,
      77,
      93,
      78,
      59,
      3,
      85,
      90,
      65,
      96,
      51,
      88,
      98,
      62,
      76,
      42,
      31,
      30,
      74,
      82,
      41,
      95,
      79,
      0,
      68,
      22,
      21,
      89,
      83,
      44,
      66,
      54,
      50,
      2,
      43,
      69,
      25,
      20,
      39,
      34,
      56,
      80,
      52,
      60,
      64,
      37,
      15,
      47,
      4,
      36,
      70,
      45,
      91,
      63,
      9,
      48,
      87,
      18,
      58,
      49,
      13,
      35,
      1,
      29,
      40,
      55,
      75,
      81,
      94,
      23,
      71,
      19,
      6,
      8,
      27,
      46,
      72,
      24,
      33,
      86,
      11,
      84,
      61,
      16,
      32,
      12,
      57,
      5,
      7,
      73,
      26,
      14,
      99,
      17,
      97
    ],
    [
      17,
      81,
      4,
      38,
      2,
      79,
      28,
      16,
      46,
      52,
      34,
      93,
      85,
      53,
      77,
      19,
      7,
      0,
      75,
      15,
      42,
      95,
      44,
      30,
      25,
      24,
      41,
      69,
      6,
      76,
      23,
      72,
      61,
      48,
      10,
      86,
      91,
      63,
      3,
      40,
      39,
      26,
      20,
      87,
      22,
      90,
      8,
      59,
      33,
      66,
      51,
      50,
      9,
      13,
      82,
      74,
      64,
      60,
      70,
      47,
      57,
      32,
      89,
      37,
      56,
      68,
      49,
      88,
      65,
      27,
      58,
      96,
      31,
      80,
      55,
      18,
      29,
      14,
      92,
      5,
      73,
      1,
      54,
      84,
      83,
      12,
      35,
      43,
      67,
      62,
      45,
      36,
      78,
      11,
      98,
      21,
      71,
      99,
      94,
      97
    ],
    [
      77,
      3,
      12,
      1,
      7,
      86,
      65,
      4,
      71,
      62,
      41,
      28,
      2,
      48,
      91,
      52,
      24,
      38,
      25,
      97,
      54,
      42,
      69,
      87,
      16,
      18,
      50,
      70,
      11,
      67,
      64,
      35,
      49,
      82,
      92,
      31,
      78,
      47,
      17,
      40,
      39,
      10,
      21,
      46,
      93,
      61,
      43,
      37,
      13,
      32,
      26,
      90,
      15,
      76,
      20,
      56,
      55,
      75,
      89,
      96,
      63,
      45,
      9,
      60,
      30,
      6,
      88,
      29,
      74,
      22,
      27,
      8,
      98,
      94,
      68,
      57,
      53,
      0,
      36,
      81,
      95,
      79,
      33,
      84,
      83,
      99,
      5,
      23,
      66,
      58,
      51,
      14,
      34,
      44,
      73,
      80,
      59,
      19,
      72,
      85
    ],
    [
      56,
      49,
      18,
      47,
      37,
      8,
      67,
      82,
      5,
      95,
      78,
      52,
      44,
      84,
      89,
      91,
      65,
      69,
      2,
      20,
      19,
      70,
      80,
      85,
      62,
      61,
      43,
      94,
      66,
      73,
      38,
      54,
      58,
      63,
      83,
      75,
      48,
      4,
      30,
      59,
      90,
      93,
      45,
      26,
      12,
      42,
      76,
      3,
      36,
      1,
      51,
      50,
      11,
      77,
      31,
      74,
      0,
      68,
      32,
      39,
      92,
      25,
      24,
      33,
      86,
      16,
      28,
      6,
      57,
      17,
      21,
      97,
      98,
      29,
      55,
      35,
      46,
      53,
      10,
      87,
      22,
      88,
      7,
      34,
      13,
      23,
      64,
      79,
      81,
      14,
      40,
      15,
      60,
      41,
      27,
      9,
      99,
      71,
      72,
      96
    ],
    [
      47,
      37,
      29,
      14,
      66,
      88,
      15,
      45,
      69,
      49,
      81,
      27,
      18,
      89,
      3,
      6,
      57,
      70,
      12,
      40,
      44,
      87,
      82,
      96,
      33,
      72,
      91,
      11,
      58,
      2,
      67,
      94,
      34,
      24,
      32,
      50,
      39,
      1,
      90,
      36,
      19,
      93,
      65,
      60,
      20,
      7,
      95,
      0,
      56,
      9,
      35,
      78,
      53,
      52,
      55,
      54,
      48,
      16,
      28,
      83,
      43,
      98,
      97,
      68,
      77,
      42,
      4,
      30,
      63,
      8,
      17,
      73,
      25,
      71,
      85,
      92,
      86,
      64,
      51,
      84,
      99,
      10,
      22,
      59,
      79,
      74,
      76,
      21,
      5,
      13,
      38,
      26,
      75,
      41,
      31,
      46,
      23,
      62,
      61,
      80
    ],
    [
      26,
      6,
      61,
      40,
      20,
      7,
      1,
      5,
      98,
      12,
      74,
      57,
      9,
      36,
      41,
      45,
      87,
      64,
      27,
      22,
      4,
      28,
      19,
      49,
      52,
      48,
      0,
      18,
      21,
      70,
      91,
      73,
      60,
      54,
      95,
      84,
      13,
      80,
      42,
      58,
      3,
      14,
      38,
      56,
      88,
      15,
      94,
      92,
      25,
      23,
      66,
      97,
      24,
      77,
      33,
      89,
      43,
      11,
      39,
      85,
      32,
      2,
      63,
      62,
      17,
      71,
      50,
      79,
      86,
      78,
      29,
      65,
      90,
      31,
      10,
      76,
      75,
      53,
      69,
      67,
      37,
      82,
      81,
      93,
      35,
      59,
      68,
      16,
      44,
      55,
      72,
      30,
      47,
      83,
      46,
      34,
      99,
      51,
      8,
      96
    ],
    [
      65,
      74,
      86,
      49,
      23,
      29,
      54,
      94,
      55,
      66,
      27,
      59,
      75,
      20,
      83,
      91,
      97,
      26,
      25,
      95,
      13,
      92,
      56,
      4,
      35,
      18,
      17,
      10,
      72,
      5,
      87,
      53,
      71,
      85,
      80,
      24,
      50,
      47,
      76,
      42,
      82,
      69,
      39,
      84,
      46,
      61,
      44,
      37,
      90,
      3,
      36,
      79,
      67,
      31,
      6,
      8,
      22,
      58,
      57,
      11,
      89,
      45,
      77,
      88,
      78,
      0,
      9,
      52,
      81,
      41,
      73,
      32,
      28,
      70,
      1,
      12,
      38,
      62,
      64,
      51,
      34,
      68,
      40,
      14,
      43,
      33,
      2,
      30,
      63,
      60,
      48,
      15,
      21,
      96,
      7,
      19,
      93,
      16,
      99,
      98
    ],
    [
      46,
      14,
      3,
      2,
      52,
      83,
      7,
      6,
      13,
      94,
      11,
      10,
      92,
      8,
      1,
      47,
      65,
      93,
      63,
      87,
      39,
      82,
      68,
      69,
      73,
      57,
      32,
      50,
      29,
      28,
      59,
      98,
      26,
      56,
      61,
      58,
      90,
      53,
      45,
      20,
      89,
      77,
      95,
      88,
      67,
      38,
      0,
      15,
      76,
      80,
      27,
      84,
      4,
      37,
      79,
      71,
      33,
      25,
      35,
      30,
      86,
      34,
      74,
      18,
      70,
      16,
      85,
      44,
      22,
      23,
      64,
      55,
      78,
      24,
      62,
      91,
      48,
      41,
      72,
      54,
      49,
      97,
      21,
      5,
      51,
      66,
      60,
      19,
      43,
      40,
      36,
      75,
      12,
      17,
      9,
      42,
      99,
      81,
      31,
      96
    ]
  ];

// ignore: non_constant_identifier_names
  String Encriptar(String psData) {
    int piKey = int.parse(psData.substring(25, 26));
    String text = '';

    if (piKey < 0 || piKey > 9) {
      return text;
    }

    int i = 0;
    try {
      for (; i + 2 <= psData.length; i += 2) {
        int num = int.parse(psData.substring(i, i + 2));
        text += mabsBoxes[piKey][num].toString().padLeft(2, '0');
      }
      if (i < psData.length) {
        text += psData.substring(i);
      }
      return text + piKey.toString();
    } catch (Exception) {
      //Logger.traza(Logger.LOG_TIPO_MSG.ERROR, "Error al encriptar la cadena [" + psData + "]" + ex.ToString(), Logger.LOG_NIV.FINAL);
      //return string.Empty;
    }
    return text;
  }

  String codificar() {
    var now = DateTime.now();
    Random randon = new Random();
    var equipo = '001';
    var codsitio = '001';
    var duracion = '003'; //Horas de validez
    var rell = '0000000000000000000000';
    var sec = '1';

    var key = randon.nextInt(9);
    while (key == 0) {
      key = randon.nextInt(9);
    }

    var verificador = 10 - key;

    var year = now.year.toString().padLeft(2, '0');
    var mes = now.month.toString().padLeft(2, '0');
    var dia = now.day.toString().padLeft(2, '0');
    var horas = now.hour.toString().padLeft(2, '0');
    var minutos = now.minute.toString().padLeft(2, '0');
    var segundos = now.second.toString().padLeft(2, '0');
    var secuencia = sec.toString().padLeft(8, '0');

    var text = '28' +
        duracion +
        codsitio +
        equipo +
        horas +
        minutos +
        segundos +
        dia +
        mes +
        year +
        key.toString() +
        secuencia +
        rell +
        verificador.toString();
    print(text);
    text = Encriptar(text);
    return text;
  }
}
